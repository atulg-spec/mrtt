<div class="flex flex-col space-y-3 md:space-y-4">
  {% for referral in referrals %}
  <div class="referral-wrapper flex flex-col level-{{ level|default:1 }}">
    
    <!-- Parent Tile -->
    <div class="referral-tile flex items-center justify-between bg-white shadow-xs border-l-4 border-emerald-400 rounded-lg md:rounded-xl px-3 md:px-5 py-3 md:py-4 hover:shadow-md transition-all duration-200">
      
      <!-- Left: Avatar + Info -->
      <div class="flex items-center space-x-3 md:space-x-4">
        <div class="relative">
          <img src="https://cdn-icons-png.flaticon.com/512/8847/8847419.png" 
               alt="Profile"
               class="w-10 h-10 md:w-12 md:h-12 rounded-full object-cover border-2 border-white shadow-sm">
          <div class="absolute -bottom-1 -right-1 w-4 h-4 md:w-5 md:h-5 rounded-full bg-emerald-400 border-2 border-white"></div>
        </div>
        
        <div class="flex flex-col">
          <span class="font-semibold text-gray-800 text-sm md:text-base truncate">
            {% if referral.first_name %}
              {{ referral.first_name }} {{ referral.last_name }}
            {% else %}
              Unknown
            {% endif %}
          </span>
          <div class="flex items-center mt-1">
            <span class="text-xs md:text-sm text-gray-600 truncate">@{{ referral.username }}</span>
            <!-- <span class="mx-2 text-gray-300 hidden sm:inline">â€¢</span>
            <span class="text-xs px-1.5 py-0.5 bg-emerald-100 text-emerald-800 rounded-full hidden sm:inline-block">Level {{ level|default:1 }}</span> -->
          </div>
        </div>
      </div>

      <!-- Right: Status & Expand Button -->
      <div class="flex items-center space-x-2 md:space-x-4">
        <div class="hidden md:flex flex-col items-end">
          <span class="text-sm text-gray-600">Joined {{ referral.date_joined|date:"M d, Y" }}</span>
          <span class="text-xs text-gray-500">{{ referral.referrals.count }} referrals</span>
        </div>
        
        {% if referral.referrals.exists %}
        <button onclick="toggleChildren({{ referral.id }}, this, {{ level|default:1|add:1 }})" 
                class="flex items-center justify-center w-7 h-7 md:w-8 md:h-8 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        {% endif %}
      </div>
    </div>

    <!-- Children container (referrals will be injected here) -->
    <div class="children-container hidden"></div>
  </div>
  {% endfor %}
</div>