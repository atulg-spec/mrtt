{% extends 'home/base.html' %}
{% block body %}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-b from-forest-50 to-forest-100 dark:from-forest-900 dark:to-forest-950 px-4 sm:px-6 lg:px-8 py-12">
    <div class="w-full max-w-md space-y-8 transform transition-all duration-300">
        <div class="text-center">
            <h2 class="mt-2 text-3xl font-bold text-forest-900 dark:text-white font-playfair tracking-tight">
                Set Password
            </h2>
            <p class="mt-2 text-sm text-forest-700 dark:text-forest-300 font-medium">
                Create a strong password to protect your tree plantation activities
            </p>
        </div>

        <div class="bg-white dark:bg-forest-900 shadow-xl rounded-xl overflow-hidden border border-forest-200 dark:border-forest-700/50 leaf-pattern">
            <div class="px-8 py-4">
                <form method="post" class="space-y-6">
                    {% csrf_token %}
                    
                    <div class="space-y-5">
                        {% for field in form %}
                        <div>
                            <div class="flex items-center justify-between">
                                <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-forest-800 dark:text-forest-200 mb-1 tracking-wide">
                                    {{ field.label }}
                                </label>
                            </div>
                            <div class="relative mt-1">
                                {{ field }}
                                {% if field.name == 'new_password1' or field.name == 'new_password2' %}
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-forest-400 hover:text-forest-600 dark:hover:text-forest-300 cursor-pointer toggle-password" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                {% endif %}
                            </div>
                            {% for error in field.errors %}
                            <p class="mt-1 text-xs font-medium text-red-600 dark:text-red-400">{{ error }}</p>
                            {% endfor %}
                            {% if field.name == 'new_password1' %}
                            <div class="mt-2">
                                <div class="flex items-center space-x-2">
                                    <div class="h-1.5 flex-1 bg-forest-200 dark:bg-forest-700 rounded-full overflow-hidden">
                                        <div class="h-full password-strength-meter" data-strength="0"></div>
                                    </div>
                                    <span class="text-xs font-medium text-forest-600 dark:text-forest-400 strength-text">Weak</span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>

                    <div class="pt-2">
                        <button type="submit" class="w-full flex justify-center items-center py-3 px-4 rounded-xl bg-gradient-to-r from-forest-600 to-forest-500 hover:from-forest-700 hover:to-forest-600 focus:outline-none focus:ring-2 focus:ring-forest-500 focus:ring-offset-2 transition-all duration-200 ease-in-out group">
                            <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                            </span>
                            <span class="text-sm font-semibold text-white tracking-wide">Save Password</span>
                        </button>
                    </div>
                </form>
            </div>
            <div class="px-8 py-4 bg-forest-50 dark:bg-forest-800/30 border-t border-forest-100 dark:border-forest-700/50 text-center">
                <a href="/contactus/" class="text-xs font-medium text-forest-600 hover:text-forest-500 dark:text-forest-400 dark:hover:text-forest-300 transition-colors">
                    Need help with your account? Contact our green team
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // Enhanced password visibility toggle
    document.querySelectorAll('.toggle-password').forEach(icon => {
        icon.addEventListener('click', function() {
            const input = this.closest('.relative').querySelector('input');
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            this.querySelector('path').setAttribute('d', isPassword ? 
                'M10 12a2 2 0 100-4 2 2 0 000 4zM.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z' :
                'M10 12a2 2 0 100-4 2 2 0 000 4zM.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10z'
            );
        });
    });

    // Premium form input styling
    const formInputs = document.querySelectorAll('input');
    formInputs.forEach(input => {
        input.classList.add(
            'block', 'w-full', 'px-4', 'py-2.5', 'rounded-lg', 'border', 
            'border-forest-200', 'dark:border-forest-700', 
            'focus:ring-2', 'focus:ring-forest-500', 'focus:border-transparent', 
            'dark:focus:ring-forest-400', 'dark:focus:border-transparent',
            'dark:bg-forest-800/50', 'dark:text-white',
            'placeholder-forest-400', 'dark:placeholder-forest-500',
            'transition-all', 'duration-200', 'ease-in-out',
            'hover:border-forest-300', 'dark:hover:border-forest-600',
            'font-medium'
        );
        
        // Password strength indicator
        if (input.type === 'password' && input.id.includes('new_password1')) {
            const meter = document.querySelector('.password-strength-meter');
            const text = document.querySelector('.strength-text');
            
            input.addEventListener('input', function() {
                const strength = calculatePasswordStrength(this.value);
                updateStrengthIndicator(strength, meter, text);
            });
        }
    });

    function calculatePasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length > 0) strength += 1;
        if (password.length >= 8) strength += 1;
        if (password.length >= 12) strength += 1;
        
        // Complexity checks
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        return Math.min(strength, 5);
    }

    function updateStrengthIndicator(strength, meter, text) {
        // Update meter width and color
        const percentage = (strength / 5) * 100;
        meter.style.width = `${percentage}%`;
        
        // Remove all color classes
        meter.classList.remove(
            'bg-red-500', 'bg-yellow-500', 'bg-forest-400', 'bg-forest-500', 'bg-forest-600',
            'dark:bg-red-400', 'dark:bg-yellow-400', 'dark:bg-forest-300', 'dark:bg-forest-400', 'dark:bg-forest-500'
        );
        
        // Add appropriate color class
        if (strength <= 1) {
            meter.classList.add('bg-red-500', 'dark:bg-red-400');
            text.textContent = 'Very Weak';
            text.classList.remove('text-yellow-500', 'text-forest-400', 'text-forest-500', 'text-forest-600');
            text.classList.add('text-red-500');
        } else if (strength <= 2) {
            meter.classList.add('bg-red-500', 'dark:bg-red-400');
            text.textContent = 'Weak';
            text.classList.remove('text-red-500', 'text-forest-400', 'text-forest-500', 'text-forest-600');
            text.classList.add('text-yellow-500');
        } else if (strength <= 3) {
            meter.classList.add('bg-yellow-500', 'dark:bg-yellow-400');
            text.textContent = 'Moderate';
            text.classList.remove('text-red-500', 'text-yellow-500', 'text-forest-500', 'text-forest-600');
            text.classList.add('text-forest-400');
        } else if (strength <= 4) {
            meter.classList.add('bg-forest-500', 'dark:bg-forest-400');
            text.textContent = 'Strong';
            text.classList.remove('text-red-500', 'text-yellow-500', 'text-forest-400', 'text-forest-600');
            text.classList.add('text-forest-500');
        } else {
            meter.classList.add('bg-forest-600', 'dark:bg-forest-500');
            text.textContent = 'Very Strong';
            text.classList.remove('text-red-500', 'text-yellow-500', 'text-forest-400', 'text-forest-500');
            text.classList.add('text-forest-600');
        }
    }
</script>

<style>
    .password-strength-meter {
        transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    input:focus {
        box-shadow: 0 0 0 2px rgba(74, 148, 97, 0.25);
    }
    .dark input:focus {
        box-shadow: 0 0 0 2px rgba(100, 179, 127, 0.25);
    }
</style>
{% endblock %}